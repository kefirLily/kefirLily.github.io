---
title: js内存优化
date: 2019-06-21 10:45:34
categories: JavaScript
tags: [JavaScript]
---



## 内存的重要性

### 什么叫内存

内存，存储，磁盘，等等很多的代名词让很多人难以理解，

有人说我的机子「内存」很大，是64G，甚至128G，或者1T，这里里的「内存大小」其实是磁盘容量，或者叫闪存大小.

简单的说设备的「内存」有内外之分，从计算机的体系结构来讲，硬盘或者闪存应当是计算机的“外存”。内存应当是计算机内部(在主板上)的一些存储器，用来保存CPU运算的中间数据和计算结果

### 内存对脚本的重要性

内存的速度直接影响「编程语言」的运行速度，

编程语言实现一段逻辑往往要定义很多「变量」，「常量」等，这些「变量」将直接存储在内存当中，当这段程序执行完成时，这些「变量」没有从内存中释放出来，这便是所谓的「内存泄露」。

很小的内存泄露对代码的运行可谓说没有多大影响，如果更多的内存泄露呢，这可能导致内存空间不足，

内存不足将直接影响代码的执行，脚步将不能声明「变量，常量」等，结果将直接卡死或者死机。

## JavaScript 内存

> 在ECMAScript标准中，没有规定任何的内存管理接口，这使得开发者没有任何的能力来操作内存，但这并不代表我们不关心内存

js中内存是非常有限的，在64位系统中约为1.4G，在32位系统下约为0.7G，

在浏览器中这些内存绰绰有余，而在nodejs中却像是被带了脚链一样（nodejs基于google的v8引擎），


## JavaScript 垃圾回收机制

js垃圾回收机制一般分为两种：标记清除（mark and sweep）、引用计数(reference counting)。

标记清除

这是javascript中最常用的垃圾回收方式。当变量进入执行环境是，就标记这个变量为“进入环境”。从逻辑上讲，永远不能释放进入环境的变量所占用的内存，因为只要执行流进入相应的环境，就可能会用到他们。当变量离开环境时，则将其标记为“离开环境”。

　　垃圾收集器在运行的时候会给存储在内存中的所有变量都加上标记。然后，它会去掉环境中的变量以及被环境中的变量引用的标记。而在此之后再被加上标记的变量将被视为准备删除的变量，原因是环境中的变量已经无法访问到这些变量了。最后。垃圾收集器完成内存清除工作，销毁那些带标记的值，并回收他们所占用的内存空间。

引用计数

另一种不太常见的垃圾回收策略是引用计数。引用计数的含义是跟踪记录每个值被引用的次数。当声明了一个变量并将一个引用类型赋值给该变量时，则这个值的引用次数就是1。相反，如果包含对这个值引用的变量又取得了另外一个值，则这个值的引用次数就减1。当这个引用次数变成0时，则说明没有办法再访问这个值了，因而就可以将其所占的内存空间给收回来。这样，垃圾收集器下次再运行时，它就会释放那些引用次数为0的值所占的内存.


我们也不能全靠js的垃圾回收机制来帮我们实现内存的合理化使用，垃圾回收机制也有他打盹的时候

可能引发内存泄露的情况

> 意外的全局变量引起的内存泄漏

> 闭包引起的内存泄漏

> 没有清理的DOM元素引用

> 被遗忘的定时器或者回调



## 内存优化

